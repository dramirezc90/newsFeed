<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation-behavior.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation-runner-behavior.html">





<dom-module id="news-element">
    <style>
        :host {
            display: block;
            width: 100%;
            float: left;
            height: 800px;
        }
        #banner {
          width: 50%;
          min-width: 600px;
          min-height: 800px;
          max-height: 800px;
          background-color: #D4CDCB;
          display: block;
          margin: 0 auto;
          border-radius: 10px 10px 0px 0px;
        }
        #header {
          width: 100%;
          height: 60px;
          background-color: #FF6855;
          border-radius: 10px 10px 0px 0px;
          padding: 17px 37px;
        }
        #menu {
          width: 45px;
        }
        #content {
          width: 100%;
          min-height: 740px;
          max-height: 740px;
          padding: 10px 37px;
          overflow: scroll;
        }
        .config {
          display: block;
          width: 50%;
          margin: 50px auto;
        }
        #modal {
          display: none;
          position: absolute;
          width: 200px;
          top: 40%;
          left: 42%;
          padding: 20px;
          background-color: #eee;
          text-align: center;
          z-index: 2;
        }
        #cover {
          display: none;
          width: 100%;
          height: 100vh;
          background-color: rgba(0, 0, 0, 0.6);
          position: absolute;
          top: 0;
          left: 0;
          z-index: 1;
        }
        .resetBtn {
          position: relative;
          display: block;
          width: 30%;
          margin: 10px auto;
          background-color: white;
          color: red;
        }
        .config label {
          display: inline-block;
          margin: 0px 15px;
          color: #eee;
          font-weight: 100;
          font-size: 1.2em;
        }
        .config input {
          padding: 4px;
          color: #383838;
          font-size: 1em;
          border-radius: 5px;
          display: inline-block;
          margin: 0px 5px;
          border: none;
        }
        .config button {
          padding: 5px 13px;
          background-color: #E8E8E8;
          border-radius: 3px;
          border: none;
          margin: 0px 15px;
          font-size: 1em;
          font-weight: 100;
        }
        @media only screen and (max-width: 650px) {
            :host {
                /*position: relative;
                float: left;
                width: 100%;*/
            }
            #banner {
              width: 90%;
            }
        }
    </style>
    <template>
        <iron-ajax 
          id="ajaxReq" 
          url="{{url}}" 
          handle-as="json" 
          last-response="{{ newsData }}" 
          on-response="handleResponse"
          on-error="_handleError">
        </iron-ajax>


        <div class="config">
            <label>URL datos</label>
            <input type="text" value="{{url::input}}">
            <button on-tap="menuPressed">Consultar</button>
        </div>
        
        <div id="banner">
          <div id="header">
            <a on-tap="menuPressed"><img id="menu" src="../../images/technology.png"></a>
          </div>
          <div id="content" >
            <template id="entradas" is="dom-repeat" items="{{ newsData }}" >
                <news-item titulo="{{item.title}}" texto="{{item.content}}" imagen="{{item.image}}" style="
                display: none" ></news-item>
            </template>
          </div>
        </div>

        <div id="cover"></div>
        <div id="modal">
            <h2 style="color: red;">Error</h2>
            <h3>La URL especificada no ha sido encontrada, modifiquela e intente de nuevo</h3>
            <button id="resetBtn" on-tap="reset">OK</button>
        </div>
    </template>

  <script>
    (function() {
      'use strict';

      Polymer({
          is: 'news-element',

          behaviors: [
            Polymer.NeonAnimatableBehavior,
            Polymer.NeonAnimationRunnerBehavior
          ],

          properties: {
              oculto : {
                type: Boolean,
                value: true,
                notify: true
              },
              url : {
                  type: String,
                  value: "scripts/news_mock.json",
                  notify: true
              },
              animationConfig: {
                  type: Object,
                  value: function() {
                      return {
                          'entry' : [
                              {
                                  name: 'bounce-up-animation',
                                  node: this.$.banner,
                                  timing: { duration: 1200 }
                              },
                              {
                                  name: 'fade-in-animation',
                                  node: this.$.banner,
                                  timing: { duration: 1100 }
                              }
                          ],
                          'exit' : {
                              name: 'fade-out-animation',
                              node: this.$.banner
                          },
                          'elems': [{
                              name: 'cascaded-animation',
                              animation: 'expand-animation',
                              transformOrigin: '0% 0',
                              axis: 'x',
                              timing: {
                                delay: 100,
                                duration: 1000
                              }
                          }]
                      }
                  }
              }
          },

          listeners: {
              'neon-animation-finish': "_onNeonAnimationFinish"
          },

          ready: function() {
              this.show();
          },

          reset: function() {
            this.$.cover.style.display = 'none';
            this.$.modal.style.display = 'none';
          },

          handleResponse: function(e) {
              this.attached();
          },

          menuPressed: function() {
            this.$.ajaxReq.generateRequest();
          },

          _onNeonAnimationFinish: function() {
              console.log("Se termino la animacion");
          },

          _handleError: function() {
            if (this.$.ajaxReq.lastError.request.status === 404 ) {
                this.$.cover.style.display = 'block';
                this.$.modal.style.display = 'block';
            }
              console.log(this.$.ajaxReq.lastError.request.status);
          },

          show: function() {
              this.style.display = 'block';
              this.cancelAnimation();
              this.playAnimation('entry');
          },

          hide: function() {
              this.style.display = 'none';
              this.cancelAnimation();
              this.playAnimation('exit');
          },

          attached: function() {
              this.async(function() {
                var nodeList = Polymer.dom(this.root).querySelectorAll('news-item');
                this.animationConfig['elems'][0].nodes = Array.prototype.slice.call(nodeList);
                for (var i = nodeList.length - 1; i >= 0; i--) {
                  
                  nodeList[i].style.display = "block";
                }
                this.playAnimation('elems');
              })
          }

      });
    })();
  </script>
</dom-module>
